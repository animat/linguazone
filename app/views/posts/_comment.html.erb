<% if comment.user.is_teacher? %>
	<div id="<%= dom_id(comment) %>" class="teacher_comment" 
				onmouseover="document.getElementById('<%= dom_id(comment) %>_controls').className = 'controls'" 
				onmouseout="document.getElementById('<%= dom_id(comment) %>_controls').className = 'hide_controls'">
		<blockquote>
			<% if comment.audio_id == 0 %>
				<p><%= h(comment.content) %></p>
			<% else%>
				<div>
					<div class="audio_player">
						<%= swf_tag "audio-widget", {:size => "215x138", :flashvars => "audio_id="+String(comment.audio_id)} %>
					</div>
					<p><%= h(comment.content) %></p>
					<br class="clearFloat" />
				</div>
			<% end %>
			<br class="clearFloat" />
		</blockquote>
		<cite><span class="author"><%= comment.user.display_name %></span> <span class="date">on <%= format_date_time(comment.updated_at) %></span></cite>
		<% if is_teacher_for(@post.course) %>
			<ul id="<%= dom_id(comment) %>_controls" class="hide_controls">
				<li>Teacher controls:</li>
				<li><%= link_to "Delete comment", comment, :method => "DELETE", :confirm => "Are you sure you want to delete this student's comment?" %></li>
			</ul>
		<% elsif comment.user == current_user %>
			<ul id="<%= dom_id(comment) %>_controls" class="hide_controls">
				<li><%= link_to "Delete this comment", comment, :method => "DELETE", :confirm => "Are you sure you want to delete your comment?" %></li>
			</ul>
		<% end %>
	</div>
<% else %>
	<div id="<%= dom_id(comment) %>" class="comment" 
				onmouseover="document.getElementById('<%= dom_id(comment) %>_controls').className = 'controls'" 
				onmouseout="document.getElementById('<%= dom_id(comment) %>_controls').className = 'hide_controls'">
		<blockquote>
			<% if comment.audio_id == 0 %>
				<p><%= h(comment.content) %></p>
			<% else%>
				<div>
					<div class="audio_player">
						<%= swf_tag "audio-widget", {:size => "215x138", :flashvars => "audio_id="+String(comment.audio_id)} %>
					</div>
					<p><%= h(comment.content) %></p>
					<br class="clearFloat" />
				</div>
			<% end %>
			<br class="clearFloat" />
		</blockquote>
		<cite><span class="author"><%= comment.user.display_name %></span> <span class="date">on <%= format_date_time(comment.updated_at) %></span></cite>
		
		<div id="<%= dom_id(comment) %>_new_teacher_note" class="new_comment_teacher_note" style="display: none">
			<% form_remote_tag :url => {:controller => "comments", :action => "update_comment"}, 
			 		:success => saved_note( dom_id(comment) ),
			 		:failure => "alert('Oops! There was an error saving your note.');",
			 		:update => dom_id(comment)+"_teacher_note_content" do %>
				<%= text_area_tag :teacher_note %><br />
				<%= hidden_field_tag :comment_id, comment.id %>
				<%= hidden_field_tag :post_id, @post.id %>
				<%= submit_tag "Add note" %>
				or 
					<%= link_to_function "cancel", {}, :id => "cancel_"+dom_id(comment)+"_teacher_note", :class => "invis" do |page| 
						page.visual_effect :slide_up, dom_id(comment)+"_new_teacher_note" 
					end %>
			<% end %>
		</div>
	
		<div id="<%= dom_id(comment) %>_teacher_note" class="comment_teacher_note" <%= 'style="display: none"' if comment.teacher_note.empty? %> >
			<p id="<%= dom_id(comment) %>_teacher_note_content"><%= comment.teacher_note %></p>
		</div>
		
		<% if is_teacher_for(@post.course) %>
			<ul id="<%= dom_id(comment) %>_controls" class="hide_controls">
				<li>Teacher controls:</li>
				<li><%= link_to "Delete comment", comment, :method => "DELETE" %></li>
				<li <%= 'style="display: none"' unless comment.teacher_note.empty? %> id="add_<%= dom_id(comment) %>_teacher_note_link">
					<%# TODO: link_to_function "Add teacher note to this comment", {}, :id => "add_"+dom_id(comment)+"_teacher_note" do |page| 
						page.visual_effect :slide_down, dom_id(comment)+"_new_teacher_note"
					end %>
				</li>
				<li <%= 'style="display: none"' if comment.teacher_note.empty? %> id="delete_<%= dom_id(comment) %>_teacher_note_link">
					<%= link_to_remote "Delete teacher note on this comment",
							:loading => "$('delete_"+dom_id(comment)+"_teacher_note').hide()",
							:url => {:controller => "comments", :action => "update_comment", 
										:comment_id => comment.id, :post_id => comment.post.id, :teacher_note => "" },
							:success => deleted_note(dom_id(comment)),
							:html => {:id => "delete_"+dom_id(comment)+"_teacher_note" } 
					%>
				</li>
			</ul>
		<% elsif comment.user == current_user %>
			<ul id="<%= dom_id(comment) %>_controls" class="hide_controls">
				<li><%= link_to "Delete this comment", comment, :method => "DELETE" %></li>
			</ul>
		<% end %>
	</div>
<% end %>