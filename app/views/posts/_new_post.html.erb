<% stylesheet 'waverec/basic.css' %>
<% stylesheet 'waverec/main.css' %>

<% javascript 'waverec/recorder' %>
<% javascript 'waverec/basic.js' %>

<h1>Create a new post</h1>

<%= form_for(@post, :html => {:id => 'upload'}) do |f| %>
 	<%= f.error_messages %>
	

	<p>
		<%= f.label :title, "Enter a title for your post" %><br />
		<%= f.text_field :title, :size => 40 %>
	</p>
	<p>
		<%= f.label :content, "Enter text for your post (optional)" %><br />
		<%= f.text_area :content, :rows => 10, :cols => 82 %>
	</p>
	<p>
		<%= f.check_box "shared" %> <%= f.label "shared", "Students can see each others' responses" %>
	</p>
	<%= f.hidden_field :course_id, :value => @course_id %>
	<%= f.hidden_field :user_id, :value => current_user.id %>
	<%= f.hidden_field :audio_id, :value => 0 %>

	<input id="upload_file" name="upload[file]" type="file" accept="audio/*.wav" capture="microphone" ><br>
	<%= transloadit :audio_encode_s3 %>
<% end %>

<div class="recording_container">
    <section class="recorder-container">

        <!-- Recorder control buttons -->
        <div class="recorder">
            <div class="recorder-border">
                <button id="lgzBtnMain" class="start-recording" onclick="lgzRec.onClick(event);">
                </button>

                <canvas id="lgzRecCanvas" width="250" height="120"  ></canvas>

            </div>
            <br>
            <a id="lgzBtnRedo" href="#" >click to clear recording and try again</a>

            <div id="lgzWinPermFWR" class="winInit" >
	            <div class="msgbox flash_info" >
	                <p> 
	                Please select 'Allow' option to access your microphone for recording.
	                <br>
	                Select the 'Remember' checkbox to skip this prompt on future recordings.
	                </p> 
	                <div id="lgzRecorderFlashDiv">
	                    <p>Your browser must have JavaScript enabled and the Adobe Flash Player installed.</p>
	                </div>
	            </div>
            </div>
            <div id="lgzWinMobile" class="winInit" >
            <div class="msgbox flash_info" >
                <p> 
                Launching your mobile audio/video recorder app to record audio.
                </p> 
                <br>
                <button onclick="lgzRec.launchMobileRecorder();">OK</button>
            </div>
            </div>
        </div>
    </section>
</div>
<button id="create_audio_blog_post" onclick="lgzRec.manualSend('#upload');" >Create post</button>
<script>
var script = 'https://assets.transloadit.com/js/jquery.transloadit2-v2-latest.js';
lgzRec.init('#upload', script);

</script>
