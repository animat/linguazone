<?php

include_once('include.php');
/*
// Update all single teacher subscriptions
$query = "SELECT * FROM users WHERE subscribe_type = 2";
echo $query;
$result = $handle->query($query) or die("ack! ".mysql_error());
echo $handle->getNumRows($result) or die("argh! ".mysql_error());

while($row = $handle->fetchArray($result)) {
	$plan = 1;
	$pin = rand(10000, 99999);
	$created = $row['created_at'];
	$updated = $row['created_at'];
	$expired = $row['expired_at'];
	
	$q = "INSERT INTO subscriptions (subscription_plan_id, pin, created_at, updated_at, expired_at) VALUES ('$plan', '$pin', '$created', '$updated', '$expired')";
	$r = $handle->query($q);
	$sub_id = $handle->getPrimaryKey();
	
	$q = "UPDATE users SET subscription_id = '$sub_id' WHERE id = '".$row['id']."'";
	$r = $handle->query($q);
	
	echo "UPDATED #".$row['id'].'<br />';
}
*/
/*
// Update all trial accounts
$query = "SELECT * FROM users WHERE subscribe_type = 3";
echo $query;
$result = $handle->query($query) or die("ack! ".mysql_error());
echo $handle->getNumRows($result) or die("argh! ".mysql_error());

while($row = $handle->fetchArray($result)) {
	$plan = 9;
	$pin = rand(10000, 99999);
	$created = $row['created_at'];
	$updated = $row['created_at'];
	$expired = $row['expired_at'];
	
	$q = "INSERT INTO subscriptions (subscription_plan_id, pin, created_at, updated_at, expired_at) VALUES ('$plan', '$pin', '$created', '$updated', '$expired')";
	$r = $handle->query($q);
	$sub_id = $handle->getPrimaryKey();
	
	$q = "UPDATE users SET subscription_id = '$sub_id' WHERE id = '".$row['id']."'";
	$r = $handle->query($q);
	
	echo "UPDATED #".$row['id'].'<br />';
}
*/
/*
// Update schoolwide accounts
$query = "SELECT * FROM schools WHERE enabled = 1";
echo $query;
$result = $handle->query($query) or die("ack! ".mysql_error());

while($row = $handle->fetchArray($result)) {
	$pin = $row['pin'];
	$created = $row['created_at'];
	$updated = $row['created_at'];
	$expired = $row['expired_at'];
	
	$teachersQuery = "SELECT * FROM users WHERE school_id = '".$row['id']."'";
	$teachersResult = $handle->query($teachersQuery);
	$numTeachers = $handle->getNumRows($teachersResult);
	if ($numTeachers < 4) {
		$plan = 2;
	} else if ($numTeachers < 7) {
		$plan = 3;
	} else {
		$plan = 4;
	}
	
	$q = "INSERT INTO subscriptions (subscription_plan_id, pin, created_at, updated_at, expired_at) VALUES ('$plan', '$pin', '$created', '$updated', '$expired')";
	$r = $handle->query($q);
	$sub_id = $handle->getPrimaryKey();
	
	while($teachersRow = $handle->fetchArray($teachersResult)) {
		$q = "UPDATE users SET subscription_id = '$sub_id' WHERE id = '".$teachersRow['id']."'";
		$r = $handle->query($q);
		echo "updated user #".$teachersRow['id']."<br />";
	}
	echo "~~~~~UPDATED school subscription #".$row['id'].'<br />';
}
*/

// Update audio recordings into the audio_clips table, not the media table
$query = "SELECT * FROM media WHERE type = 2";
$result = $handle->query($query);
while ($row = $handle->fetchArray($result)) {
	$tally = $row['used_count'];
	echo "found audio id :: #".$row['id']."<br />";
	
	$q2 = "INSERT INTO audio_clips (id, used_in_games_tally) VALUES ('".$row['id']."', '$tally')";
	$r2 = $handle->query($q2);
	
	$q3 = "DELETE FROM media WHERE id = '".$row['id']."'";
	$r3 = $handle->query($q3);
}

?>